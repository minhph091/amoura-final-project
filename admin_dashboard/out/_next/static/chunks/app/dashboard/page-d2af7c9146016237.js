(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{352:(e,t,a)=>{"use strict";a.r(t),a.d(t,{StatsService:()=>s,statsService:()=>n});var r=a(18992);class s{async getDashboard(){let e=JSON.parse(localStorage.getItem("user_data")||"null"),t=localStorage.getItem("auth_token");if(!e||!t||"ADMIN"!==e.roleName)throw Error("Access denied. Only ADMIN can view dashboard.");let a=await r.Z.getDashboard();if(!a.success||!a.data)throw Error(a.error||"Failed to fetch dashboard data");return a.data}}let n=new s},18992:(e,t,a)=>{"use strict";a.d(t,{Z:()=>l});var r=a(65988),s=a(39910);class n{async getDashboard(){try{let e=await r.u.get(s.Sn.ADMIN.DASHBOARD);if(!e.success||!e.data)return{success:!1,error:e.error||"Failed to fetch dashboard data"};let t=e.data,a={totalUsers:t.totalUsers||0,totalMatches:t.totalMatches||0,totalMessages:t.totalMessages||0,todayUsers:t.todayUsers||0,todayMatches:t.todayMatches||0,todayMessages:t.todayMessages||0,activeUsersToday:t.activeUsersToday||0,userGrowthChart:Array.isArray(t.userGrowthChart)&&t.userGrowthChart.length>0?t.userGrowthChart.filter(e=>e&&e.date).map(e=>({date:e.date,newUsers:e.newUsers||0})):[],matchingSuccessChart:Array.isArray(t.matchingSuccessChart)&&t.matchingSuccessChart.length>0?t.matchingSuccessChart.filter(e=>e&&e.date).map(e=>({date:e.date,totalSwipes:e.totalSwipes||0,totalMatches:e.totalMatches||0})):[],recentActivities:Array.isArray(t.recentActivities)&&t.recentActivities.length>0?t.recentActivities.filter(e=>e&&e.activityType).map(e=>({activityType:e.activityType,description:e.description||"No description",timestamp:e.timestamp||new Date().toISOString()})):[]};return{success:!0,data:a}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to fetch dashboard data"}}}async getUsers(e){try{let t=new URLSearchParams;(null==e?void 0:e.cursor)&&t.append("cursor",e.cursor.toString()),(null==e?void 0:e.limit)&&t.append("limit",e.limit.toString()),(null==e?void 0:e.direction)&&t.append("direction",e.direction);let a="".concat(s.Sn.ADMIN.USERS).concat(t.toString()?"?".concat(t.toString()):"");return await r.u.get(a)}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to fetch users"}}}async searchUsers(e,t){try{let a=new URLSearchParams;a.append("q",e),(null==t?void 0:t.cursor)&&a.append("cursor",t.cursor.toString()),(null==t?void 0:t.limit)&&a.append("limit",t.limit.toString()),(null==t?void 0:t.direction)&&a.append("direction",t.direction);let n="".concat(s.Sn.ADMIN.USER_SEARCH,"?").concat(a.toString());return await r.u.get(n)}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to search users"}}}async getUserById(e){try{return await r.u.get(s.Sn.ADMIN.USER_BY_ID(e))}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to fetch user details"}}}async updateUserStatus(e,t){try{return await r.u.put(s.Sn.ADMIN.UPDATE_USER_STATUS(e),t)}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to update user status"}}}}let l=new n},26690:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>G});var r=a(95155),s=a(12115),n=a(20415),l=a(352);let i=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toLocaleString(),c=e=>{if(!e)return"Unknown";try{return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch(e){return"Invalid Date"}},o=e=>{if(!e)return"Unknown";try{let t=new Date(e),a=new Date().getTime()-t.getTime(),r=Math.floor(a/6e4),s=Math.floor(a/36e5),n=Math.floor(a/864e5);if(r<1)return"Just now";if(r<60)return"".concat(r," minutes ago");if(s<24)return"".concat(s," hours ago");if(n<7)return"".concat(n," days ago");return c(e)}catch(e){return"Invalid Date"}},d=e=>{switch(null==e?void 0:e.toUpperCase()){case"ACTIVE":return"bg-green-100 text-green-800 border-green-200";case"INACTIVE":default:return"bg-gray-100 text-gray-800 border-gray-200";case"SUSPEND":case"SUSPENDED":return"bg-red-100 text-red-800 border-red-200";case"PENDING":return"bg-yellow-100 text-yellow-800 border-yellow-200"}},u=(e,t)=>{if(!e)return{name:"Unknown User",email:"unknown@example.com",status:"ACTIVE"};if("USER_REGISTRATION"===t){let t=e.match(/New user (.+?) \((.+?)\) registered/);if(t){let e=t[1],a=t[2];return{name:e,email:"".concat(a,"@example.com"),status:"ACTIVE"}}return{name:"New User",email:"newuser@example.com",status:"ACTIVE"}}return"USER_STATUS_UPDATE"===t?{name:"User Status Updated",email:"status@example.com",status:e.includes("ACTIVE")?"ACTIVE":e.includes("SUSPEND")?"SUSPEND":e.includes("INACTIVE")?"INACTIVE":"ACTIVE"}:{name:t.replace(/_/g," ").toLowerCase().replace(/\b\w/g,e=>e.toUpperCase()),email:"activity@example.com",status:"ACTIVE"}};var h=a(88482),m=a(77657),x=a(35695),g=a(33109),f=a(92138),p=a(17580),v=a(51976),y=a(97210);function j(e){let{title:t,value:a,description:s,icon:l,trend:c,href:o,color:d}=e,{t:u}=(0,n.o)(),p=(0,x.useRouter)(),v="number"==typeof a?i(a):a||"0",y="number"==typeof c?c:0;return(0,r.jsxs)(h.Zp,{className:"card-hover overflow-hidden border-none shadow-lg",children:[(0,r.jsx)("div",{className:"h-1 ".concat(d)}),(0,r.jsxs)(h.aR,{className:"flex flex-row items-center justify-between pb-2",children:[(0,r.jsx)(h.ZB,{className:"text-sm font-medium font-primary",children:t}),(0,r.jsx)("div",{className:"p-2 ".concat(d," bg-opacity-20 rounded-full"),children:l})]}),(0,r.jsxs)(h.Wu,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold font-heading",children:v}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground font-primary",children:s}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(g.A,{className:"h-4 w-4 ".concat(y>0?"text-green-500":"text-destructive"," mr-1")}),(0,r.jsxs)("span",{className:"text-xs ".concat(y>0?"text-green-500":"text-destructive"),children:[y,"% ",u.fromLastMonth]})]}),(0,r.jsxs)(m.$,{className:"text-xs text-white btn-view hover:opacity-90",onClick:()=>p.push(o),children:[u.view," ",(0,r.jsx)(f.A,{className:"ml-1 h-3 w-3"})]})]})]})]})}function N(){let{t:e}=(0,n.o)(),[t,l]=(0,s.useState)(null),[i,c]=(0,s.useState)(!0),[o,d]=(0,s.useState)(null);if((0,s.useEffect)(()=>{(async function(){c(!0),d(null);try{let e=await (await Promise.resolve().then(a.bind(a,352))).statsService.getDashboard();l(e)}catch(e){e.message.includes("Backend service unavailable")||e.message.includes("Network connection failed")?d("Backend service unavailable"):d(e.message||"Failed to load statistics")}finally{c(!1)}})()},[]),i)return(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,r.jsx)("div",{className:"animate-pulse bg-gray-200 h-32 rounded"}),(0,r.jsx)("div",{className:"animate-pulse bg-gray-200 h-32 rounded"}),(0,r.jsx)("div",{className:"animate-pulse bg-gray-200 h-32 rounded"}),(0,r.jsx)("div",{className:"animate-pulse bg-gray-200 h-32 rounded"})]});if(o)return(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg",children:["⚠️ ",o]});if(!t)return(0,r.jsx)("div",{className:"bg-gray-50 border border-gray-200 text-gray-600 p-4 rounded-lg",children:"\uD83D\uDCCA Đang chờ dữ liệu dashboard từ server..."});let u=0;if((null==t?void 0:t.userGrowthChart)&&Array.isArray(t.userGrowthChart)&&t.userGrowthChart.length>1){let e=t.userGrowthChart.slice(-7),a=t.userGrowthChart.slice(-14,-7),r=e.reduce((e,t)=>e+((null==t?void 0:t.newUsers)||0),0),s=a.reduce((e,t)=>e+((null==t?void 0:t.newUsers)||0),0);s>0&&(u=Math.round((r-s)/s*100))}let h=0;if((null==t?void 0:t.matchingSuccessChart)&&Array.isArray(t.matchingSuccessChart)&&t.matchingSuccessChart.length>1){let e=t.matchingSuccessChart.slice(-7),a=t.matchingSuccessChart.slice(-14,-7),r=e.reduce((e,t)=>e+((null==t?void 0:t.totalMatches)||0),0),s=a.reduce((e,t)=>e+((null==t?void 0:t.totalMatches)||0),0);s>0&&(h=Math.round((r-s)/s*100))}let m=0;if(((null==t?void 0:t.totalMessages)||0)>0&&((null==t?void 0:t.todayMessages)||0)>0){let e=(t.totalMessages-t.todayMessages)/30;e>0&&(m=Math.round((t.todayMessages-e)/e*100))}let x=[{title:e.totalUsers,value:(null==t?void 0:t.totalUsers)||0,description:e.totalUsersPlatform,icon:(0,r.jsx)(p.A,{className:"h-4 w-4 text-primary"}),trend:u,href:"/dashboard/users",color:"bg-blue-500"},{title:e.activeUsersToday,value:(null==t?void 0:t.activeUsersToday)||0,description:e.activeUsersTodayDesc,icon:(0,r.jsx)(g.A,{className:"h-4 w-4 text-primary"}),trend:0,href:"/dashboard/users",color:"bg-green-500"},{title:e.totalMatches,value:(null==t?void 0:t.totalMatches)||0,description:e.totalMatchesPlatform,icon:(0,r.jsx)(v.A,{className:"h-4 w-4 text-primary"}),trend:h,href:"/dashboard/matches",color:"bg-rose-500"},{title:e.totalMessages,value:(null==t?void 0:t.totalMessages)||0,description:e.totalMessagesSent,icon:(0,r.jsx)(y.A,{className:"h-4 w-4 text-primary"}),trend:m,href:"/dashboard/messages",color:"bg-amber-500"}];return(0,r.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:x.map(e=>(0,r.jsx)(j,{...e},e.title))})}var S=a(83540),w=a(99445),b=a(94754),A=a(96025),T=a(52071),D=a(27086),E=a(41213),R=a(64683);function U(){let{t:e}=(0,n.o)(),[t,a]=(0,s.useState)([]),[i,c]=(0,s.useState)(!0),[o,d]=(0,s.useState)(null);return((0,s.useEffect)(()=>{(async()=>{c(!0),d(null);try{let e=await l.statsService.getDashboard(),t=null==e?void 0:e.userGrowthChart,r=[];Array.isArray(t)&&t.length>0&&(r=t.filter(e=>e&&e.date).map(e=>({date:e.date,newUsers:e.newUsers||0})).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())),a(r)}catch(e){a([]),e.message.includes("Backend service unavailable")||e.message.includes("Network connection failed")?d("Backend service unavailable"):d(e.message||"Failed to load data")}finally{c(!1)}})()},[]),i)?(0,r.jsxs)(h.Zp,{children:[(0,r.jsxs)(h.aR,{children:[(0,r.jsx)(h.ZB,{children:e.userGrowth}),(0,r.jsx)(h.BT,{children:e.newUsersPerDay})]}),(0,r.jsx)(h.Wu,{className:"h-80 flex items-center justify-center",children:e.loadingText})]}):o?(0,r.jsxs)(h.Zp,{children:[(0,r.jsx)(h.aR,{children:(0,r.jsx)(h.ZB,{children:e.userGrowth})}),(0,r.jsx)(h.Wu,{className:"h-80 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center text-gray-600",children:[(0,r.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCC8"}),(0,r.jsx)("p",{className:"mt-2",children:"Biểu đồ tăng trưởng đang được ph\xe1t triển"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Vui l\xf2ng chờ backend team deploy admin endpoints"})]})})]}):t&&0!==t.length?(0,r.jsxs)(h.Zp,{className:"card-hover",children:[(0,r.jsxs)(h.aR,{children:[(0,r.jsx)(h.ZB,{children:e.userGrowth}),(0,r.jsx)(h.BT,{children:e.newUsersPerDay})]}),(0,r.jsx)(h.Wu,{className:"h-80",children:(0,r.jsx)(S.u,{width:"100%",height:"100%",children:(0,r.jsxs)(w.Q,{data:t,margin:{top:10,right:30,left:0,bottom:0},children:[(0,r.jsx)(b.d,{strokeDasharray:"3 3",opacity:.2}),(0,r.jsx)(A.W,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),(0,r.jsx)(T.h,{}),(0,r.jsx)(D.m,{contentStyle:{backgroundColor:"var(--background)",borderColor:"var(--border)",borderRadius:"var(--radius)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},itemStyle:{color:"var(--foreground)"},labelStyle:{color:"var(--foreground)",fontWeight:"bold"},labelFormatter:e=>new Date(e).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})}),(0,r.jsx)(E.Gk,{type:"monotone",dataKey:"newUsers",stroke:"hsl(346, 77%, 49%)",fill:"hsl(346, 77%, 49%, 0.2)",name:e.newUsers}),(0,r.jsx)(R.s,{})]})})})]}):(0,r.jsxs)(h.Zp,{children:[(0,r.jsxs)(h.aR,{children:[(0,r.jsx)(h.ZB,{children:e.userGrowth}),(0,r.jsx)(h.BT,{children:e.newUsersPerDay})]}),(0,r.jsx)(h.Wu,{className:"h-80 flex items-center justify-center text-muted-foreground",children:"No data available for the last 30 days"})]})}var k=a(3401),C=a(92305);function I(){let{t:e}=(0,n.o)(),[t,a]=(0,s.useState)([]),[i,c]=(0,s.useState)(!0),[o,d]=(0,s.useState)(null);return((0,s.useEffect)(()=>{(async()=>{c(!0),d(null);try{let e=await l.statsService.getDashboard(),t=null==e?void 0:e.matchingSuccessChart,r=[];Array.isArray(t)&&t.length>0&&(r=t.filter(e=>e&&e.date).map(e=>({date:e.date,totalSwipes:e.totalSwipes||0,totalMatches:e.totalMatches||0})).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())),a(r)}catch(e){a([]),e.message.includes("Backend service unavailable")||e.message.includes("Network connection failed")?d("Backend service unavailable"):d(e.message||"Failed to load data")}finally{c(!1)}})()},[]),i)?(0,r.jsxs)(h.Zp,{children:[(0,r.jsxs)(h.aR,{children:[(0,r.jsx)(h.ZB,{children:e.matchingSuccessRate}),(0,r.jsx)(h.BT,{children:e.totalSwipesVsMatches})]}),(0,r.jsx)(h.Wu,{className:"h-80 flex items-center justify-center",children:e.loadingText})]}):o?(0,r.jsxs)(h.Zp,{children:[(0,r.jsx)(h.aR,{children:(0,r.jsx)(h.ZB,{children:e.matchingSuccessRate})}),(0,r.jsx)(h.Wu,{className:"h-80 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center text-gray-600",children:[(0,r.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCCA"}),(0,r.jsx)("p",{className:"mt-2",children:"Chức năng thống k\xea đang được ph\xe1t triển"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Vui l\xf2ng chờ backend team deploy admin endpoints"})]})})]}):t&&0!==t.length?(0,r.jsxs)(h.Zp,{className:"card-hover",children:[(0,r.jsxs)(h.aR,{children:[(0,r.jsx)(h.ZB,{children:e.matchingSuccessRate}),(0,r.jsx)(h.BT,{children:e.totalSwipesVsMatches})]}),(0,r.jsx)(h.Wu,{className:"h-80",children:(0,r.jsx)(S.u,{width:"100%",height:"100%",children:(0,r.jsxs)(k.E,{data:t,margin:{top:10,right:30,left:0,bottom:0},children:[(0,r.jsx)(b.d,{strokeDasharray:"3 3",opacity:.2}),(0,r.jsx)(A.W,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),(0,r.jsx)(T.h,{}),(0,r.jsx)(D.m,{contentStyle:{backgroundColor:"var(--background)",borderColor:"var(--border)",borderRadius:"var(--radius)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},itemStyle:{color:"var(--foreground)"},labelStyle:{color:"var(--foreground)",fontWeight:"bold"},labelFormatter:e=>new Date(e).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})}),(0,r.jsx)(C.y,{dataKey:"totalSwipes",fill:"hsl(240, 10%, 70%)",radius:[4,4,0,0],name:e.totalSwipes}),(0,r.jsx)(C.y,{dataKey:"totalMatches",fill:"hsl(346, 77%, 49%)",radius:[4,4,0,0],name:e.totalMatches}),(0,r.jsx)(R.s,{})]})})})]}):(0,r.jsxs)(h.Zp,{children:[(0,r.jsxs)(h.aR,{children:[(0,r.jsx)(h.ZB,{children:e.matchingSuccessRate}),(0,r.jsx)(h.BT,{children:e.totalSwipesVsMatches})]}),(0,r.jsx)(h.Wu,{className:"h-80 flex items-center justify-center text-muted-foreground",children:"No data available for the last 30 days"})]})}var M=a(69663),_=a(88145),O=a(5623),B=a(67133);function P(){let{t:e}=(0,n.o)(),[t,a]=(0,s.useState)([]),[i,c]=(0,s.useState)(!0),[x,g]=(0,s.useState)(null);if((0,s.useEffect)(()=>{(async()=>{c(!0),g(null);try{let e=await l.statsService.getDashboard(),t=((null==e?void 0:e.recentActivities)||[]).map((e,t)=>{let a=u(e.description,e.activityType);return{id:t,userName:a.name,userEmail:a.email,userPhotoUrl:null,userStatus:a.status,timestamp:e.timestamp,location:"Vietnam",activityType:e.activityType,description:e.description}}).slice(0,10);a(t)}catch(e){a([]),e.message.includes("Backend service unavailable")||e.message.includes("Network connection failed")?g("Failed to load activities"):g(e.message||"Failed to load activities")}finally{c(!1)}})()},[]),i)return(0,r.jsx)(h.Zp,{children:(0,r.jsxs)(h.Wu,{className:"flex items-center justify-center p-8",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mr-3"}),e.loadingText]})});if(x)return(0,r.jsx)(h.Zp,{children:(0,r.jsxs)(h.Wu,{className:"text-center p-8 text-gray-600",children:[(0,r.jsx)("span",{className:"text-2xl",children:"\uD83D\uDC65"}),(0,r.jsx)("p",{className:"mt-2",children:"Hoạt động gần đ\xe2y đang được ph\xe1t triển"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Vui l\xf2ng chờ backend team deploy admin endpoints"})]})});let f=e=>d(e),p=e=>o(e),v=t=>{if(!t)return e.unknown;let a=t.split(", ");return a.length>1?"".concat(a[0],", ").concat(a[a.length-1]):t};return(0,r.jsxs)(h.Zp,{className:"col-span-3",children:[(0,r.jsxs)(h.aR,{className:"pb-6",children:[(0,r.jsx)(h.ZB,{className:"text-xl font-semibold",children:e.recentActivities}),(0,r.jsx)(h.BT,{children:e.latestSystemActivities})]}),(0,r.jsx)(h.Wu,{className:"space-y-0",children:(0,r.jsxs)("div",{className:"rounded-md border",children:[(0,r.jsxs)("div",{className:"grid grid-cols-5 gap-4 p-4 font-medium text-muted-foreground bg-muted/50 border-b text-sm",children:[(0,r.jsx)("div",{children:e.userActivity}),(0,r.jsx)("div",{children:e.status}),(0,r.jsx)("div",{children:e.date}),(0,r.jsx)("div",{children:e.location}),(0,r.jsx)("div",{children:e.actions})]}),(0,r.jsx)("div",{className:"divide-y divide-border",children:0===t.length?(0,r.jsx)("div",{className:"p-8 text-center text-muted-foreground",children:e.noDataAvailable}):t.map((t,a)=>(0,r.jsxs)("div",{className:"grid grid-cols-5 gap-4 p-4 items-center hover:bg-muted/25 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)(M.eu,{className:"h-8 w-8",children:[(0,r.jsx)(M.BK,{src:(null==t?void 0:t.userPhotoUrl)||"/placeholder-user.jpg",alt:(null==t?void 0:t.userName)||"User"}),(0,r.jsx)(M.q5,{className:"text-xs",children:(null==t?void 0:t.userName)?t.userName.split(" ").map(e=>e[0]).join("").slice(0,2).toUpperCase():"U"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-sm",children:(null==t?void 0:t.userName)||e.unknownUser}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:(null==t?void 0:t.userEmail)||e.unknownEmail})]})]}),(0,r.jsx)("div",{children:(0,r.jsx)(_.E,{variant:"outline",className:"text-xs font-medium ".concat(f((null==t?void 0:t.userStatus)||"active")),children:(null==t?void 0:t.userStatus)||e.active})}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:p((null==t?void 0:t.timestamp)||"")}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:v((null==t?void 0:t.location)||e.unknown)}),(0,r.jsx)("div",{children:(0,r.jsxs)(B.rI,{children:[(0,r.jsx)(B.ty,{asChild:!0,children:(0,r.jsxs)(m.$,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,r.jsx)("span",{className:"sr-only",children:"Open menu"}),(0,r.jsx)(O.A,{className:"h-4 w-4"})]})}),(0,r.jsxs)(B.SQ,{align:"end",children:[(0,r.jsx)(B._2,{children:e.viewDetails}),(0,r.jsx)(B._2,{children:e.sendMessage}),(0,r.jsx)(B._2,{children:e.viewProfile})]})]})})]},a))})]})})]})}function Z(){let{t:e}=(0,n.o)(),[t,a]=(0,s.useState)(null),[i,c]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{let e=async()=>{c(!0);try{let e=await l.statsService.getDashboard();a(e)}catch(e){}finally{c(!1)}};e();let t=setInterval(e,3e5);return()=>clearInterval(t)},[]),i)?(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-center min-h-[60vh]",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),(0,r.jsxs)("p",{className:"ml-4 text-muted-foreground",children:[e.loadingText,"..."]})]})}):(0,r.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,r.jsx)(N,{}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsx)(U,{}),(0,r.jsx)(I,{})]}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)(P,{})})]})}function F(e){let{role:t}=e,{t:a}=(0,n.o)(),s="bg-gray-400";return"ADMIN"===t?s="bg-red-600":"MODERATOR"===t?s="bg-blue-600":"USER"===t&&(s="bg-green-600"),(0,r.jsx)("span",{className:"px-3 py-1 rounded-md text-white text-sm font-bold ".concat(s," self-start mt-1"),children:(e=>{switch(e){case"ADMIN":return a.admin;case"MODERATOR":return a.moderator||"MODERATOR";case"USER":return a.user||"USER";default:return e}})(t)})}var V=a(96033),W=a(84917);function G(){let{t:e}=(0,n.o)(),[t,a]=(0,s.useState)(null),[l,i]=(0,s.useState)(!0),[c,o]=(0,s.useState)(null),d=(0,x.useRouter)();return((0,s.useEffect)(()=>{try{let e=W.y.getCurrentUser(),t=localStorage.getItem("auth_token");if(!e||!t){localStorage.clear(),d.replace("/login"),i(!0);return}let r=e.roleName||null;if(a(r),"ADMIN"!==r&&"MODERATOR"!==r){o("Bạn kh\xf4ng c\xf3 quyền truy cập trang quản trị");return}if("MODERATOR"===r){d.replace("/");return}o(null)}catch(e){o("Authentication error occurred"),localStorage.clear(),d.replace("/login")}finally{i(!1)}},[d]),l)?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:e.loadingText})]}):c?(0,r.jsx)("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-red-600 mb-2",children:e.errorTitle}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:c}),(0,r.jsx)("button",{onClick:()=>d.replace("/login"),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Go to Login"})]})}):"MODERATOR"===t?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Redirecting..."})]}):(0,r.jsx)(V.default,{children:(0,r.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,r.jsxs)("div",{className:"flex flex-row items-center gap-3 mb-6",children:[(0,r.jsx)("h1",{className:"font-heading text-4xl font-bold text-gradient-primary tracking-tight",children:e.dashboardOverview}),t&&(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)(F,{role:t})})]}),(0,r.jsx)(V.default,{fallback:(0,r.jsx)("div",{className:"text-red-500 p-4 rounded bg-red-50",children:e.dashboardComponentFailed}),children:(0,r.jsx)(Z,{})})]})})}},69663:(e,t,a)=>{"use strict";a.d(t,{BK:()=>c,eu:()=>i,q5:()=>o});var r=a(95155),s=a(12115),n=a(85977),l=a(53999);let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.bL,{ref:t,className:(0,l.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...s})});i.displayName=n.bL.displayName;let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n._V,{ref:t,className:(0,l.cn)("aspect-square h-full w-full",a),...s})});c.displayName=n._V.displayName;let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.H4,{ref:t,className:(0,l.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...s})});o.displayName=n.H4.displayName},84917:(e,t,a)=>{"use strict";a.d(t,{y:()=>l});var r=a(65988),s=a(39910);class n{async registerInitiate(e){try{return await r.u.post(s.Sn.AUTH.REGISTER_INITIATE,e)}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to register"}}}async login(e){try{let t=await r.u.post(s.Sn.AUTH.LOGIN,e);if(t.success&&t.data){if(r.u.setToken(t.data.accessToken),localStorage.setItem("auth_token",t.data.accessToken),localStorage.setItem("refresh_token",t.data.refreshToken),localStorage.setItem("user_data",JSON.stringify(t.data.user)),document.cookie="auth_token=".concat(t.data.accessToken,"; path=/; max-age=86400"),"ADMIN"===t.data.user.roleName||"MODERATOR"===t.data.user.roleName)return localStorage.setItem("isLoggedIn","true"),t;return await this.logout(),{success:!1,error:"Bạn kh\xf4ng c\xf3 quyền truy cập trang quản trị. Chỉ ADMIN hoặc MODERATOR mới được ph\xe9p đăng nhập."}}return this.clearAllAuthData(),t}catch(e){return this.clearAllAuthData(),{success:!1,error:e instanceof Error?e.message:"Login failed"}}}clearAllAuthData(){r.u.clearToken(),localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user_data"),localStorage.removeItem("isLoggedIn"),document.cookie="auth_token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;"}async refreshToken(){let e=localStorage.getItem("refresh_token");if(!e)return{success:!1,error:"No refresh token available"};try{let t=await r.u.post(s.Sn.AUTH.REFRESH,e);return t.success&&t.data&&(r.u.setToken(t.data.accessToken),localStorage.setItem("refresh_token",t.data.refreshToken),localStorage.setItem("user_data",JSON.stringify(t.data.user))),t}catch(e){return this.logout(),{success:!1,error:e instanceof Error?e.message:"Token refresh failed"}}}async logout(){let e=localStorage.getItem("refresh_token");if(e)try{await r.u.post(s.Sn.AUTH.LOGOUT,e)}catch(e){}this.clearAllAuthData(),window.dispatchEvent(new StorageEvent("storage",{key:"auth_token",newValue:null,oldValue:localStorage.getItem("auth_token")}))}async changePassword(e){return r.u.post(s.Sn.AUTH.CHANGE_PASSWORD,e)}async requestPasswordReset(e){return r.u.post(s.Sn.AUTH.PASSWORD_RESET_REQUEST,e)}async verifyPasswordResetOtp(e){return r.u.post(s.Sn.AUTH.PASSWORD_RESET_VERIFY_OTP,e)}async resetPassword(e){return r.u.post(s.Sn.AUTH.PASSWORD_RESET,e)}async resendPasswordResetOtp(e){return r.u.post(s.Sn.AUTH.PASSWORD_RESET_RESEND_OTP,{sessionToken:e})}getCurrentUser(){let e=localStorage.getItem("user_data");return e?JSON.parse(e):null}isAuthenticated(){let e=localStorage.getItem("auth_token"),t=localStorage.getItem("user_data");return!!(e&&t)}isAdminOrModerator(){let e=this.getCurrentUser();return!!(e&&("ADMIN"===e.roleName||"MODERATOR"===e.roleName))}}let l=new n},88145:(e,t,a)=>{"use strict";a.d(t,{E:()=>i});var r=a(95155);a(12115);var s=a(74466),n=a(53999);let l=(0,s.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...s}=e;return(0,r.jsx)("div",{className:(0,n.cn)(l({variant:a}),t),...s})}},88482:(e,t,a)=>{"use strict";a.d(t,{BT:()=>o,Wu:()=>d,ZB:()=>c,Zp:()=>l,aR:()=>i,wL:()=>u});var r=a(95155),s=a(12115),n=a(53999);let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});l.displayName="Card";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...s})});i.displayName="CardHeader";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});c.displayName="CardTitle";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...s})});o.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...s})});d.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...s})});u.displayName="CardFooter"},93974:(e,t,a)=>{Promise.resolve().then(a.bind(a,26690))},96033:(e,t,a)=>{"use strict";a.d(t,{default:()=>d});var r=a(95155),s=a(12115),n=a(88482),l=a(77657),i=a(1243),c=a(53904);class o extends s.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){}render(){if(this.state.hasError){var e;return this.props.fallback?this.props.fallback:(0,r.jsxs)(n.Zp,{className:"w-full max-w-md mx-auto mt-8",children:[(0,r.jsxs)(n.aR,{className:"text-center",children:[(0,r.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:(0,r.jsx)(i.A,{className:"h-6 w-6 text-red-600"})}),(0,r.jsx)(n.ZB,{className:"mt-2 text-lg font-medium text-gray-900",children:"Something went wrong"})]}),(0,r.jsxs)(n.Wu,{className:"text-center space-y-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:(null===(e=this.state.error)||void 0===e?void 0:e.message)||"An unexpected error occurred"}),(0,r.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,r.jsxs)(l.$,{variant:"outline",size:"sm",onClick:this.handleReset,className:"flex items-center gap-2",children:[(0,r.jsx)(c.A,{className:"h-4 w-4"}),"Try Again"]}),(0,r.jsx)(l.$,{size:"sm",onClick:this.handleReload,className:"flex items-center gap-2",children:"Reload Page"})]})]})]})}return this.props.children}constructor(...e){super(...e),this.state={hasError:!1,error:null},this.handleReset=()=>{this.setState({hasError:!1,error:null})},this.handleReload=()=>{window.location.reload()}}}let d=o}},e=>{var t=t=>e(e.s=t);e.O(0,[277,655,900,118,823,415,403,441,684,358],()=>t(93974)),_N_E=e.O()}]);